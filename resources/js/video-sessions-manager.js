(()=>{"use strict";var A;!function(A){A.AUTH_REQUIRED="auth-required",A.CONNECTED="connected",A.AUTHORIZED="authorized",A.DISCONNECTED="disconnected",A.UPDATE_USER="update-user",A.ACTIVE_VIDEO_SESSION="active-video-session",A.VIDEO_SESSION_DETAILS="video-session-details",A.VIDEO_STREAM_READY="video-stream-ready",A.LOCAL_VIDEO_STREAM_READY="local-video-stream-ready",A.REMOTE_VIDEO_STREAM_READY="remote-video-stream-ready",A.VIDEO_SESSIONS_LIST="video-sessions-list",A.COUNTRIES_LIST="countries-list",A.HIGHLIGHT_MEMBERS="highlight-members",A.ERROR_MESSAGE="error-message",A.START_TALK="start-talk",A.END_TALK="end-talk",A.TALK_RESULT="talk-result",A.NOTIFICATIONS_LIST="notifications-list",A.NEW_NOTIFICATION="new-notifications",A.SEE_NOTIFICATION="see-notification",A.CONVERSATIONS_LIST="conversations-list",A.INCOMING_MESSAGE="incoming-message",A.MESSAGES_LIST="messages-list",A.SEE_MESSAGE="see-message",A.CONVERSATION_UPDATE="conversation-update",A.NEW_COMPLAINT_MESSAGE="new-complaint-message"}(A||(A={}));const e=A,t="VS: ",i={info(...A){console.log(t,...A)},warn(...A){console.warn(t,...A)},error(...A){console.error(t,...A)}};class n{constructor(){this._ws=null,this._messagesHandler=null,this._connectHandler=null,this._disconnectHandler=null,this._queue=[]}setHost(A){this._host=A}connect(){i.info("Connecting to the signaling server"),this._ws=new WebSocket(this._host),this._ws.onopen=()=>{i.info("Successfully connected to the signaling server"),null!==this._connectHandler&&this._connectHandler()},this._ws.onmessage=A=>{if(null!==this._messagesHandler)try{this._messagesHandler(JSON.parse(A.data))}catch(A){i.error("Unable to parse incoming message: ",A)}},this._ws.onclose=A=>{null!==this._disconnectHandler&&this._disconnectHandler(),setTimeout((()=>{i.info("Connection to signaling server has been closed. Trying to reconnect..."),this.connect()}),1e3)}}processQueue(){for(let A=0;A<this._queue.length;A++)this._ws.readyState==WebSocket.OPEN&&this.sendInternal(this._queue[A]);this._queue=[]}onConnect(A){this._connectHandler=A}onDisconnect(A){this._disconnectHandler=A}onMessage(A){this._messagesHandler=A}sendBinary(A){i.info(">>> [Binary data]",A.size),this._ws.send(A)}send(A){null!==this._ws&&this._ws.readyState===WebSocket.OPEN?this.sendInternal(A):this._queue.push(A)}sendSilent(A){null!==this._ws&&this._ws.send(JSON.stringify(A))}sendInternal(A){i.info(">>>",A.action),this._ws.send(JSON.stringify(A))}}var o;!function(A){A.CONFIGURATION="config",A.AUTH="auth",A.UPDATE_USER="update-user",A.RTC_OFFER="rtc-offer",A.RTC_ANSWER="rtc-answer",A.RTC_ICE="rtc-ice",A.CREATE_VIDEO_SESSION="create-video-session",A.DELETE_VIDEO_SESSION="delete-video-session",A.ACTIVE_VIDEO_SESSION="active-video-session",A.VIDEO_SESSIONS_LIST="video-sessions-list",A.COUNTRIES_LIST="countries-list",A.VIDEO_SESSION_DETAILS="video-session-details",A.VIDEO_SESSION_UPDATED="video-session-updated",A.JOIN_VIDEO_SESSION="join-video-session",A.LEAVE_VIDEO_SESSION="leave-video-session",A.HIGHLIGHT_MEMBERS="highlight-members",A.ERROR_MESSAGE="error-message",A.START_TALK="start-talk",A.END_TALK="end-talk",A.RATE_TALK="rate-talk",A.TALK_RESULT="talk-result",A.LEAVE_TALK="leave-talk",A.RESTART_SERVER="restart-server",A.LOGS="logs",A.NOTIFICATIONS_LIST="notifications-list",A.NEW_NOTIFICATION="new-notification",A.SEE_NOTIFICATION="see-notification",A.SEND_NOTIFICATION="send-notification",A.SEND_NOTIFICATION_TO_ALL="send-notification-to-all",A.CONVERSATIONS_LIST="conversations-list",A.SEND_MESSAGE="send-message",A.INCOMING_MESSAGE="incoming-message",A.MESSAGES_LIST="messages-list",A.SEE_MESSAGE="see-message",A.CONVERSATION_UPDATE="conversation-update",A.SEND_COMPLAINT_MESSAGE="send-complaint-message",A.NEW_COMPLAINT_MESSAGE="new-complaint-message"}(o||(o={}));const s=o;class a{constructor(){this._handlers=new Map}addEventHandler(A,e){this._handlers.has(A)||this._handlers.set(A,new Set),this._handlers.get(A).add(e)}dispatchEvent(A,e){if(this._handlers.has(A))for(let t of this._handlers.get(A))t(e)}}var r=function(A,e,t,i){return new(t||(t=Promise))((function(n,o){function s(A){try{r(i.next(A))}catch(A){o(A)}}function a(A){try{r(i.throw(A))}catch(A){o(A)}}function r(A){var e;A.done?n(A.value):(e=A.value,e instanceof t?e:new t((function(A){A(e)}))).then(s,a)}r((i=i.apply(A,e||[])).next())}))};class d{constructor(){this._recordedStream=null,this._canvas=document.createElement("canvas"),this._localVideo=document.createElement("video"),this._remoteVideo=document.createElement("video"),this._onRecordedChunkReady=null,this._recorder=null,this._audioContext=null,this._isRecording=!1,this._localVideo.volume=0,this._remoteVideo.volume=0,this._remoteVideo.addEventListener("loadedmetadata",(()=>{this._remoteVideo.play().catch((A=>i.error("Unable to play remote video:",A)))}))}startRecording(A,e,t){return r(this,void 0,void 0,(function*(){let i=t;this._isRecording=!0,this._recordedStream=yield this.composeRecordedVideo(A,e),this._recorder=new MediaRecorder(this._recordedStream,{videoBitsPerSecond:102400,mimeType:"video/webm; codecs=vp8,opus"}),this._recorder.ondataavailable=A=>{null!==this._onRecordedChunkReady&&this._onRecordedChunkReady(A.data,i)},this._recorder.start(1e3)}))}stopRecording(){this._isRecording=!1,this._localVideo.srcObject=null,this._remoteVideo.srcObject=null,null!==this._recorder&&(this._recorder.stop(),this._recorder=null),null!==this._audioContext&&(this._audioContext.close().catch((A=>i.error(A))),this._audioContext=null),null!==this._recordedStream&&(this._recordedStream.getTracks().forEach((A=>A.stop())),this._recordedStream=null)}composeRecordedVideo(A,e){return new Promise((t=>r(this,void 0,void 0,(function*(){let i;this._localVideo.srcObject=null,this._remoteVideo.srcObject=null,this._remoteVideo.addEventListener("loadedmetadata",(()=>{let n=this._canvas,o=n.getContext("2d");n.width=Math.floor(this._remoteVideo.videoWidth/3),n.height=Math.floor(this._remoteVideo.videoHeight/3);let s=()=>{if(!this._localVideo.paused&&!this._localVideo.ended){let A=.35,e=this._localVideo,t=e.videoWidth-n.width>e.videoHeight-n.height?n.width/e.videoWidth:n.height/e.videoHeight,i=Math.round(e.videoWidth*A*t),a=Math.round(e.videoHeight*A*t);if(null!==this._remoteVideo){let A=this._remoteVideo,e=A.videoWidth-n.width>A.videoHeight-n.height?n.width/A.videoWidth:n.height/A.videoHeight;o.drawImage(this._remoteVideo,A.videoWidth-n.width>A.videoHeight-n.height?0:n.width/2-A.videoWidth*e/2,A.videoWidth-n.width>A.videoHeight-n.height?n.height/2-A.videoHeight*e/2:0,A.videoWidth*e,A.videoHeight*e)}else o.fillStyle="#000",o.fillRect(0,0,n.width,n.height);o.drawImage(this._localVideo,n.width-i,n.height-a,i,a),this._isRecording&&setTimeout(s,1e3/30)}};if(s(),i=n.captureStream(30),void 0!==window.AudioContext){this._audioContext=new AudioContext;const t=this._audioContext.createMediaStreamSource(A),n=this._audioContext.createMediaStreamSource(e),o=this._audioContext.createMediaStreamDestination();t.connect(o),n.connect(o),o.stream.getAudioTracks().length>0&&i.addTrack(o.stream.getAudioTracks()[0])}else A.getAudioTracks().forEach((A=>i.addTrack(A)));t(i)}));let n=new MediaStream;A.getVideoTracks().forEach((A=>n.addTrack(A))),this._localVideo.srcObject=n,yield this._localVideo.play(),n=new MediaStream,e.getVideoTracks().forEach((A=>n.addTrack(A))),this._remoteVideo.srcObject=n,yield this._remoteVideo.play()}))))}onRecordedChunkReady(A){this._onRecordedChunkReady=A}}function c(A,e){return new Promise((t=>{let i=Date.now();if(!0===A())return t();let n=setInterval((()=>{(1==A()||void 0!==e&&Date.now()-i>e)&&(clearInterval(n),t())}),50)}))}var h=function(A,e,t,i){return new(t||(t=Promise))((function(n,o){function s(A){try{r(i.next(A))}catch(A){o(A)}}function a(A){try{r(i.throw(A))}catch(A){o(A)}}function r(A){var e;A.done?n(A.value):(e=A.value,e instanceof t?e:new t((function(A){A(e)}))).then(s,a)}r((i=i.apply(A,e||[])).next())}))};class l{constructor(A){this._connection=null,this._localStream=null,this._remoteStream=null,this._initiatesConnection=!1,this._iceCandidates=[],this._videoSender=null,this._audioSender=null,this._isMuted=!1,this._gettingLocalStream=!1,this._onLocalStreamReady=null,this._onAllStreamsReady=null,this._signalingServer=A,this.createLocalStream().catch((A=>i.error(A)))}mute(){this._audioSender.track.enabled=!1}unmute(){this._audioSender.track.enabled=!0}isInitiator(){return this._initiatesConnection}configure(A){null===this._connection?(this._connection=new RTCPeerConnection(A),this._connection.addEventListener("iceconnectionstatechange",(()=>{"failed"===this._connection.iceConnectionState&&this._connection.restartIce()})),this._connection.onnegotiationneeded=()=>h(this,void 0,void 0,(function*(){if(i.info("Negotiation needed"),this._initiatesConnection)try{let A=yield this._connection.createOffer();yield this._connection.setLocalDescription(A),this._signalingServer.send({action:s.RTC_OFFER,sdp:A.sdp})}catch(A){i.error("Unable to set local offer:",A)}else this._connection.restartIce()})),this._connection.ontrack=A=>{A.track.onunmute=()=>{"video"===A.track.kind&&(this._remoteStream=A.streams[0],null!==this._onAllStreamsReady&&this._onAllStreamsReady(this._localStream,this._remoteStream))}},this._connection.onicecandidate=A=>{A.candidate&&this._signalingServer.send({action:s.RTC_ICE,ice:A.candidate})}):i.warn("Trying to configure peer connection when it's already configured.")}initiateConnection(){return h(this,void 0,void 0,(function*(){this._initiatesConnection=!0,"connected"!==this._connection.connectionState?yield this.createLocalStream():i.info("Connection already established")}))}reconnect(){null!==this._connection&&(i.info("Reconnecting..."),this._connection.restartIce())}setRtcAnswer(A){return h(this,void 0,void 0,(function*(){try{yield this._connection.setRemoteDescription({type:"answer",sdp:A}),yield this.setCachedIceCandidates()}catch(A){i.error("Unable to set remote answer:",A)}}))}setRtcOffer(A){return h(this,void 0,void 0,(function*(){yield this.createLocalStream();try{yield this._connection.setRemoteDescription({type:"offer",sdp:A}),yield this.setCachedIceCandidates();let e=yield this._connection.createAnswer();yield this._connection.setLocalDescription(e),this._signalingServer.send({action:s.RTC_ANSWER,sdp:e.sdp})}catch(A){i.error("Unable to set local answer:",A)}}))}createLocalStream(){return new Promise((A=>h(this,void 0,void 0,(function*(){if(null===this._localStream){if(this._gettingLocalStream)return yield c((()=>!1===this._gettingLocalStream)),void A(this._localStream);if(this._gettingLocalStream=!0,i.info("Created local stream"),this._localStream=yield navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),null!==this._onLocalStreamReady&&this._onLocalStreamReady(this._localStream),null===this._connection)return A(this._localStream);this._localStream.getTracks().forEach((A=>{let e=this._connection.addTrack(A,this._localStream);"audio"===A.kind?(this._isMuted&&(e.track.enabled=!1),this._audioSender=e):this._videoSender=e})),this._gettingLocalStream=!1}else A(this._localStream)}))))}setRemoteIce(A){null===this._connection.remoteDescription?this._iceCandidates.push(A):this._connection.addIceCandidate(A).catch((A=>{i.error("Unable to set remote ice:",A)}))}setCachedIceCandidates(){return h(this,void 0,void 0,(function*(){let A=[];for(let e=0;e<this._iceCandidates.length;e++)A.push(this._connection.addIceCandidate(this._iceCandidates[e]));yield Promise.all(A).catch((A=>i.error("Unable to set remote ice:",A))),this._iceCandidates=[]}))}disconnect(){null!==this._localStream&&this._localStream.getTracks().forEach((A=>A.stop())),this._localStream=null,this._remoteStream=null,this._connection.close()}onLocalStreamReady(A){this._onLocalStreamReady=A}onAllStreamsReady(A){this._onAllStreamsReady=A}}const E=()=>"undefined"!=typeof navigator&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,g=()=>"wakeLock"in navigator,S=new class{constructor(){if(this._enabled=!1,this._wakeLock=null,this.noSleepTimer=null,this.noSleepVideo=null,g()){const A=()=>{null!==this._wakeLock&&"visible"===document.visibilityState&&this.enable().catch((A=>i.error(A)))};document.addEventListener("visibilitychange",A),document.addEventListener("fullscreenchange",A)}else this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.addEventListener("loadedmetadata",(()=>{this.noSleepVideo.duration<=1?this.noSleepVideo.setAttribute("loop",""):this.noSleepVideo.addEventListener("timeupdate",(()=>{this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}))})),this.addSourceToVideo(this.noSleepVideo,"webm","data:video/webm;base64,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"),this.addSourceToVideo(this.noSleepVideo,"mp4","data:video/mp4;base64,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")}addSourceToVideo(A,e,t){let i=document.createElement("source");i.src=t,i.type=`video/${e}`,A.appendChild(i)}enable(){return g()?navigator.wakeLock.request("screen").then((A=>{this._wakeLock=A,this._enabled=!0,i.info("Wake Lock active."),this._wakeLock.addEventListener("release",(()=>{i.info("Wake Lock released.")}))})).catch((A=>{this._enabled=!1,i.error(`${A.name}, ${A.message}`)})):E()?(this.disable(),i.warn("\n                Wake enabled for older iOS devices. This can interrupt\n                active or long-running network requests from completing successfully.\n                See https://github.com/richtr/NoSleep.js/issues/15 for more details.\n            "),this.noSleepTimer=window.setInterval((()=>{document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))}),15e3),this._enabled=!0,Promise.resolve()):this.noSleepVideo.play().then((A=>(this._enabled=!0,A))).catch((A=>{this._enabled=!1,i.error(A)}))}disable(){g()?(this._wakeLock&&this._wakeLock.release().catch((A=>i.error(A))),this._wakeLock=null):E()?null!==this.noSleepTimer&&(i.warn("Wake now disabled for older iOS devices."),window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this._enabled=!1}};var I;!function(A){A[A.TEXT=0]="TEXT",A[A.IMAGE=1]="IMAGE",A[A.SMILE=2]="SMILE"}(I||(I={}));const C=I;window.VideoSessionsManager=class extends a{constructor(){super(),this._signalingServer=null,this._videoProcessor=null,this._peerConfig=null,this._peerConnection=null,this._logIndex=0,this._userId=null,this._authorized=!1,this._isAdmin=!1,this._isTalking=!1,this._currentVideoId=null,this._lastVideoId=null,this._logsHijacking=!1,S.enable().catch((A=>i.error(A))),this.prepareVideoProcessor(),this.prepareSignalingServer()}setUserId(A){null==this._userId&&(this._userId=A)}prepareVideoProcessor(){this._videoProcessor=new d,this._videoProcessor.onRecordedChunkReady(((A,e)=>{let t=(new TextEncoder).encode(e),i=(n=t.length,Uint8Array.of((4278190080&n)>>24,(16711680&n)>>16,(65280&n)>>8,(255&n)>>0));var n;let o=new Blob([i,t,A]);this._signalingServer.sendBinary(o)}))}prepareSignalingServer(){this._signalingServer=new n;let A=A=>{this._signalingServer.send({action:s.AUTH,payload:A})};this._signalingServer.onConnect((()=>{this.dispatchEvent(e.CONNECTED,A),this.dispatchEvent(e.AUTH_REQUIRED,A)})),this._signalingServer.onDisconnect((()=>{this._authorized=!1,this.dispatchEvent(e.DISCONNECTED)})),this._signalingServer.onMessage((A=>{this.handleSignalingMessage(A)}))}handleSignalingMessage(A){if(i.info("<<<",A.action),A.action!==s.CONFIGURATION)if(A.action!==s.COUNTRIES_LIST)if(A.action!==s.VIDEO_SESSIONS_LIST){if(A.action===s.AUTH||this._authorized)switch(A.action){case s.AUTH:"ok"===A.payload.toLowerCase()&&(this._authorized=!0,this._isAdmin=A.isAdmin,this.dispatchEvent(e.AUTHORIZED,this._isAdmin));break;case s.ACTIVE_VIDEO_SESSION:this.dispatchEvent(e.ACTIVE_VIDEO_SESSION,A.videoSessionInfo);break;case s.VIDEO_SESSION_DETAILS:this.dispatchEvent(e.VIDEO_SESSION_DETAILS,{info:A.videoSessionInfo,contacts:A.contacts});break;case s.HIGHLIGHT_MEMBERS:this.dispatchEvent(e.HIGHLIGHT_MEMBERS,{videoSessionId:A.videoSessionId,members:A.members});break;case s.ERROR_MESSAGE:this.dispatchEvent(e.ERROR_MESSAGE,A.message);break;case s.START_TALK:let t=!this._isTalking;this._isTalking=!0;let n=this._currentVideoId!==A.videoId;this._currentVideoId=A.videoId,this._lastVideoId=A.videoId,null!==this._peerConnection&&t?this._userId===A.initiator&&(n&&this._videoProcessor.stopRecording(),this._peerConnection.reconnect()):(this.createPeerConnection(),this._userId===A.initiator&&this._peerConnection.initiateConnection().catch((A=>i.error(A)))),this.dispatchEvent(e.START_TALK,this._userId===A.initiator);break;case s.END_TALK:this._isTalking=!1,this._currentVideoId=null,null!==this._peerConnection&&this._peerConnection.disconnect(),this._peerConnection=null,this._videoProcessor.stopRecording(),this.dispatchEvent(e.END_TALK);break;case s.TALK_RESULT:this.dispatchEvent(e.TALK_RESULT,A.talkResult);break;case s.RTC_OFFER:null===this._peerConnection&&this.createPeerConnection(),this._peerConnection.setRtcOffer(A.sdp);break;case s.RTC_ANSWER:null===this._peerConnection&&this.createPeerConnection(),this._peerConnection.setRtcAnswer(A.sdp);break;case s.RTC_ICE:null===this._peerConnection&&this.createPeerConnection(),this._peerConnection.setRemoteIce(A.ice);break;case s.NOTIFICATIONS_LIST:this.dispatchEvent(e.NOTIFICATIONS_LIST,A.notifications);break;case s.NEW_NOTIFICATION:this.dispatchEvent(e.NEW_NOTIFICATION,A.notification);break;case s.CONVERSATIONS_LIST:this.dispatchEvent(e.CONVERSATIONS_LIST,A.conversations);break;case s.INCOMING_MESSAGE:this.dispatchEvent(e.INCOMING_MESSAGE,{message:A.message,conversationId:A.conversationId});break;case s.MESSAGES_LIST:this.dispatchEvent(e.MESSAGES_LIST,{conversationId:A.conversationId,messages:A.messages});break;case s.CONVERSATION_UPDATE:this.dispatchEvent(e.CONVERSATION_UPDATE,A.conversation);break;case s.NEW_COMPLAINT_MESSAGE:this.dispatchEvent(e.NEW_COMPLAINT_MESSAGE,{complaintId:A.complaintId,message:A.message});break;default:i.warn("Unacceptable action: "+A.action)}}else this.dispatchEvent(e.VIDEO_SESSIONS_LIST,A.videoSessions);else this.dispatchEvent(e.COUNTRIES_LIST,A.countries);else A.logs&&this.hijackLogs()}leaveTalk(A){this._signalingServer.send({action:s.LEAVE_TALK,comment:A})}createPeerConnection(){this._peerConnection=new l(this._signalingServer),null===this._peerConfig&&i.error("RTCConfiguration is not set"),this._peerConnection.configure(this._peerConfig),this._peerConnection.onLocalStreamReady((A=>{this.dispatchEvent(e.LOCAL_VIDEO_STREAM_READY,A)})),this._peerConnection.onAllStreamsReady(((A,t)=>{this._peerConnection.isInitiator()&&(this._videoProcessor.stopRecording(),this._videoProcessor.startRecording(A,t,this._currentVideoId).catch((A=>i.error(A)))),this.dispatchEvent(e.REMOTE_VIDEO_STREAM_READY,t)}))}connectToSignalingServer(A){this._signalingServer.setHost(A),this._signalingServer.connect()}configureRTCPeer(A){this._peerConfig=A,null!==this._peerConnection&&this._peerConnection.configure(A)}initiateConnection(){this._peerConnection.initiateConnection()}muteMicrophone(){this._peerConnection.mute()}unmuteMicrophone(){this._peerConnection.unmute()}isAuthorized(){return this._authorized}createVideoSession(A){this._signalingServer.send({action:s.CREATE_VIDEO_SESSION,videoSessionInfo:A})}deleteVideoSession(A){this._signalingServer.send({action:s.DELETE_VIDEO_SESSION,videoSessionId:A})}requestCountriesListUpdate(){this._signalingServer.send({action:s.COUNTRIES_LIST})}requestUserUpdate(){this._signalingServer.send({action:s.UPDATE_USER})}requestVideoSessionsListUpdate(A){this._signalingServer.send({action:s.VIDEO_SESSIONS_LIST,country:A})}requestVideoSessionDetails(A){this._signalingServer.send({action:s.VIDEO_SESSION_DETAILS,videoSessionId:A})}joinVideoSession(A){this._signalingServer.send({action:s.JOIN_VIDEO_SESSION,videoSessionId:A})}leaveVideoSession(A){this._signalingServer.send({action:s.LEAVE_VIDEO_SESSION,videoSessionId:A})}requestTalkResult(){this._signalingServer.send({action:s.TALK_RESULT})}requestConversationsList(){this._signalingServer.send({action:s.CONVERSATIONS_LIST})}requestMessagesList(A,e){this._signalingServer.send({action:s.MESSAGES_LIST,conversationId:A,fromId:e})}sendMessage(A,e){this._signalingServer.send({action:s.SEND_MESSAGE,conversationId:e,type:C.TEXT,text:A})}seeMessage(A,e){this._signalingServer.send({action:s.SEE_MESSAGE,conversationId:A,messageId:e})}sendNotification(A,e){this._signalingServer.send({action:s.SEND_NOTIFICATION,userId:A,message:e})}sendNotificationToAll(A,e){this._signalingServer.send({action:s.SEND_NOTIFICATION_TO_ALL,users:A,message:e})}onConnect(A){this.addEventHandler(e.CONNECTED,A)}onAuthorized(A){this.addEventHandler(e.AUTHORIZED,A)}onAuthRequired(A){this.addEventHandler(e.AUTH_REQUIRED,A)}onActiveVideoSession(A){this.addEventHandler(e.ACTIVE_VIDEO_SESSION,A)}onVideoStreamReady(A){this.addEventHandler(e.VIDEO_STREAM_READY,A)}onLocalVideoStreamReady(A){this.addEventHandler(e.LOCAL_VIDEO_STREAM_READY,A)}onRemoteVideoStreamReady(A){this.addEventHandler(e.REMOTE_VIDEO_STREAM_READY,A)}onCountriesListUpdate(A){this.addEventHandler(e.COUNTRIES_LIST,A)}onVideoSessionsListUpdate(A){this.addEventHandler(e.VIDEO_SESSIONS_LIST,A)}onVideoSessionDetails(A){this.addEventHandler(e.VIDEO_SESSION_DETAILS,A)}onHighlightMembers(A){this.addEventHandler(e.HIGHLIGHT_MEMBERS,A)}onErrorMessage(A){this.addEventHandler(e.ERROR_MESSAGE,A)}onStartTalk(A){this.addEventHandler(e.START_TALK,A)}onEndTalk(A){this.addEventHandler(e.END_TALK,A)}onTalkResult(A){this.addEventHandler(e.TALK_RESULT,A)}onNotificationsUpdate(A){this.addEventHandler(e.NOTIFICATIONS_LIST,A)}onNewNotification(A){this.addEventHandler(e.NEW_NOTIFICATION,A)}onConversationsListUpdate(A){this.addEventHandler(e.CONVERSATIONS_LIST,A)}onConversationUpdate(A){this.addEventHandler(e.CONVERSATION_UPDATE,A)}onIncomingMessage(A){this.addEventHandler(e.INCOMING_MESSAGE,A)}onMessagesUpdate(A){this.addEventHandler(e.MESSAGES_LIST,A)}onComplaintMessage(A){this.addEventHandler(e.NEW_COMPLAINT_MESSAGE,A)}seeNotification(A){this._signalingServer.send({action:s.SEE_NOTIFICATION,id:A})}rateLastTalk(A){this._signalingServer.send({action:s.RATE_TALK,rate:A})}sendComplaintMessage(A,e){this._signalingServer.send({action:s.SEND_COMPLAINT_MESSAGE,complaintId:A,message:e})}restartServer(){this._signalingServer.send({action:s.RESTART_SERVER})}hijackLogs(){return A=this,e=void 0,i=function*(){if(this._logsHijacking)return;this._logsHijacking=!0,yield c((()=>this._authorized));let A=console.log,e=console.warn,t=console.error;this.saveLogs(navigator.userAgent,"",1),console.log=(...e)=>{this.saveLogs("Log:   "+e.join(" "),"",1),A.apply(console,e)},console.warn=(...A)=>{this.saveLogs("Warn:  "+A.join(" "),"",1),e.apply(console,A)},console.error=(...A)=>{this.saveLogs("Error: "+A.join(" "),"",1),t.apply(console,A)},window.onerror=(A,e,t)=>{this.saveLogs(A,e,t)}},new((t=void 0)||(t=Promise))((function(n,o){function s(A){try{r(i.next(A))}catch(A){o(A)}}function a(A){try{r(i.throw(A))}catch(A){o(A)}}function r(A){var e;A.done?n(A.value):(e=A.value,e instanceof t?e:new t((function(A){A(e)}))).then(s,a)}r((i=i.apply(A,e||[])).next())}));var A,e,t,i}saveLogs(A,e,t){this._signalingServer.sendSilent({action:s.LOGS,message:A,file:e,line:t,index:this._logIndex++})}}})();